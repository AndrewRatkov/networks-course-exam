## Периферия сети. Конечные системы. Сети доступа. Кабельная сеть доступа.
- Конечная система = хост (компьютеры, серверы, ...)
- Сеть доступа = сеть, которая физически соединяет конечную систему с первым маршрутизатором (домашние сети доступа, корпоративные, ...)
- DSL (Digital Subscriber Line) -- использование существующей телефонной линии до мультиплексора центрального офиса. В центральном офисе есть соответствующий мультиплексор, который перенаправляет данные в сеть, а голос в телефонную линию.
    - входящая скорость передачи < 2,5 Мбит/c (обычно < 1 Мбит/c)
    - исходящая скорость передачи < 24 Мбит/c (обычно < 10 Мбит/c)

- Кабельная сеть доступа
    - мультиплексирование по частоте: разные каналы передаются по разным полосам частот
    - пакеты от головных станций идут по нисходящему каналу во все дома
    - пакет, исходящий из дома, по восходящему каналу идет в головную станцию
    - HFC: гибридная оптико-коаксиальная сеть: асимметричная: входящая скорость передачи до 30 Мбит/c, исходящая 2 Мбит/c
    - Сеть из оптоволокна и коаксиального кабеля соединяет дома с провайдером:
        - дома делят доступ к головной кабельной станции, в отличие от DSL

## Физические носители. Витая пара, коаксиал, оптоволокно. Радиоканалы.
- медная витая пара
    - несколько пар изолированных медных проводников. В каждрй паре они скручены вместе. В паре передается один и тот же сигнал, но в одном +, а в другом -, приёмник восстанавливает сигнал как разность сигналов в паре. Это добавляет устойчивость к внешним помехам.
    - неэкранированная витая пара: отсутствие дополнительных экранов из фольги или металлической оплетки. Проще установка, дешевле, все равно остаточно надежно. Чаще используется.
- коаксиальный кабель
    - два концентрических медных проводника (данные передаются по внутреннему)
    - двунаправленное соединение
    - широкополосный доступ: мультиканальная передача данных HFC
- оптоволоконный кабель
    - передает световые импульсы, из-за этого не чувствителен к ЭМ помехам, большая производмительность, меньше ошибок
- радиоканалы
    - передача сигнала ЭМ волнами радиодиапазона
    - минусы: отражение, интерференция, затухание сигнала, поглощение препятствиями
    - двунаправленная передача, дешево
    - виды:
        - наземные: LAN(wi-fi), глобальные(3g,4g,5g)
        - спутниковые геостационарные станции (далеко, сигнал идет долго), низкоорбитальные (ближе к Земле, но нужно частое переподключение)

## Ядро сети. Основные функции. Задержка передачи. Передача с промежуточным накоплением.
- Ядро сети -- набор коммутаторов пакетов и каналов связи, кот. взаимодействуют с хостами.
    - его свойства:
    1. маршрутизация (алгоритм маршрутизации) (составление таблички)
    2. перенаправление -- передача пакетов со входов на соответствующий выход (руководствуясь табличкой)
- Коммутация пакетов -- когда сообщение прикладного уровня делится хостом на пакеты
- Задержка передачи пакета: L/R, где L бит -- размер пакета, R бит/с -- скорость передачи. = пропускная способность = емкость
- Передача с промежуточным накоплением: передача дальше в сеть происходит только после приема вмего пакета. То есть если маршрутизаторов ("передатчиков") на пути пакета k, то задержка k*L/R.

## Коммутация пакетов. Коммутация каналов. Мультиплексирование с разделением по частоте и по времени.

- Коммутация каналов: выделенные ресурсы на линии от источника до приемника резервируются для вызова.
    - гарантируется постоянная скорость и минимальная задержка
    - участок канала простаивает, если через него не проходит вызов
    - телефонные сети
    - возможно мильтиплексирование:
        1.  FDM -- с разделением по частоте (как в радио)
        2.  TDM -- с разделением по времени
- Коммутация пакетов
    - данные разбиваются на пакеты
    - пакеты погут двигаться по разным маршрутам
    - эффективнее, можетпредоставить доступ к сети большему числу пользователей
- Мультиплексирование:
    - по частоте (требует более сложного оборудования) 
    - по времени
    - гибридное

## Интернет как сеть сетей. Уровни провайдеров.
- за $O(n^2)$ все сети доступа соединять слишком затратно
- несколько уровней провайдеров
    1. Провайдеры верхнего уровня (12) -- вершина иерархии. Соединены между собой, также имеют Internet Exchange Points -- точки обмена трафиком.
    2. Региональные интернет-провайдеры -- связывают сети доступа с провайдерами 1 уровня.
    3. Сети доступа
Также провайдеры контента Google, Microsoft создают собственные сети,  добавляясь на 1 уровень. Чтобы быть ближе к пользователям.

## Задержки при пакетной коммутации. Задержка обработки, ожидания, передачи и распространения.
- скорость поступления пакетов больше, чем скорость отправки
- пакеты ожидают в очереди маршрутизаторов
- 4 типа задержек в узле сети:
    1. обработки -- контроль ошибок, определение исходящей линии для посылки пакета
    2. ожидания -- когда пакет находится в очереди
    3. передачи -- время на проталкивание всех битов пакета в линию. L/R, где L -- размер пакета, R -- полоса пропускания линии (бит/с)
    4. распространения пакета в линии связи. d/s, где d -- длина канала, s -- скорость распространения
- пусть a -- средняя скорость поступления пакетов. La бит в секунду в среднем поступает в очередь. При La/R -> 1 задержка ожидания стремится к oo.
- traceroute -- программа для подсчёта таких задержек.
## Потеря пакетов. Пропускная способность.
- Пропускная способность сети -- количество данных, которое сеть способна передать за секунду. Может быть мгновенной и средней.
- если очередь маршрутизатора заполнена, новые пакеты отбрасываются. В теории он может быть переотправлен предыдущим узлом или исходной конечной системой, откуда он идет.
- пропускная способность последовательного соединения линий с максимальными скоростями передачи R_1, ..., R_n равна $min(R_1, ..., R_n)$.

## Стек протоколов Интернета. Эталонная модель ISO/OSI.
Нужно как-то организовать сетевую архитектуру.
1) Прикладной -- для поддержки сетевых приложений. FTP, SMTP, HTTP. *пакет*
2) Транспортный -- на уровне ОС -- передача данных между приложениями. TCP, UDP *сегмент*
3) Сетевой -- передача дейтаграмм от источника к приёмнику IP, протоколы маршрутизации. *дейтаграмма*
4) Канальный -- передача данных между соседними узлами сети (Ethernet, 802.11(wifi), PPP) *кадр*
5) Физический: биты в среде передачи

В эталонной модели ISO/OSI между прикладным и транспортным также есть
- представительский -- чтобы приложениям верно интерпретировать данные в разл. форматах (шифрование, сжатие)
- сеансовый -- средства для контроля сеансом и его восстановление в случае разрыва соединения.

Но эти задачи могут быть решены на прикладном уровне разработчиком приложения.

![screen00.png](screen_for_md00.png)

Основные ресурсы на упаковку/распаковку пакетов -- хосты, конечные системы.

## Сетевая безопасность. Вирус, червь, программы-шпионы, DDoS-атака. Сниффинг. IP спуффинг (подмена адреса).
Безопасность не была частью замысла создателей Интернета.
- Вирус: саморазмножающееся ПО, заражает устройство после получения/запуска объекта (например, из письма по электронной почте)
- Червь: саморазмножающееся ПО, заражает устройство после получения объекта, запускается без участия пользователя.
- Программы шпионы: анализ нажатий клавиш, посещенных веб-сайтов
- DDoS -- Distributed Denial of Service -- перегрузка серверов приложения (или тп) искусственным трафиком, исходящим от откружающих хостов. Делает приложение недоступным для пользователя.
    
    В приложении, часто, на каждый запрос может создаваться по потоку, при перегрузке клиентами это F.

- IP-спуффинг
    В широковещательной сети (wifi в кафе) левые устройства могут заниматься *сниффингом* -- читать все проходящие пакеты (как Wireshark). *библиотека pcap в C++*

    На основе удачно перехваченной информации, злоумышленники могут начать отправлять в сеть пакеты с ложным IP-адресом источника.

## История Интернета.
+ 1961-1972 -- зарождение основ
    - 1961 (Клейнрок) -- эффективность теории очередей
    - 1964 (Бэран) -- сети с коммутацией пакетов министерства обороны США.
    - ARPANet (Advanced Research Project Agency)
        - 1969 -- заработал первый узел сети
        - 1972 -- публичная демонстрация (Роберт Кан)
            - NCP (Network Control Protocol)
            - первая эл. почта
            - 15 узлов

+ 1972-1980 -- развитие частных сетей и Интернета
    - сеть ALOHA на Гавайах, ПД по спутниковой связи
    - 1974 (Кан, Серф) -- архитектура, объединяющая сети. Появление термина Интернет.
    - 1974 -- Ethernet в Xerox PARC
    - др. компании
    - 1979 -- 200 узлов в ARPANet
    - появление TCP, UDP, IP протоколов для сетевого взаимодействия.

    - принципы сетевого взаимодействия Серфа и Кана:
        1. минимализм: не надо менять внутреннюю архитектуру
        2. децентрализованное управление
        3. маршрутизаторы не сохраняют состояние
        4. качество обслуживания

+ 1980-1990 -- новые протоколы, распространение сетей
    - 1983 -- внедрение TCP/IP
    - 1982 -- протокол SMTP для электронной почты
    - 1983 -- протокол DNS для трансляции имён в адреса
    - 1985 -- протокол FTP
    - 1988 -- механизм контроля данных в TCP
    - ~1985 -- появление новых сетей. Minitel (Франция)

+ 1990-2000
    - конец ARPANet
    - World Wide Web
    - HyperText (Буш 1945)
    - HTML, HTTP (Тим Бернерс-Ли)
    - коммерциализация сети
    - новые разработки, файлообменные одноранговые сети, появление сетевой безопасности, 10^8 пользователей, появление скоростей в Гбит/с.

+ н.в.
    - миллиарды хостов, мобильная революция
    - развитие скоростей беспроводных сетей
    - развитие широкополосного доступа, в т.ч. быстрого беспроводного
    - соцсети
    - провайдеры контента (Google,  Microsoft) создают свои сети
    - электронная коммерция
    - новые проблемы -- безопасность/приватность, цензура

## Прикладной уровень. Протоколы. Клиент-серверная и одноранговая (P2P) архитектуры.
Уровень поддержки сетевых приложений, работает поверх транспортного. На хостах работает ПО приложения, ему надо обмениваться пакетами. Приложение умеет формировать и раскодировать свои пакеты по своим личным правилам. Для передачи они транслируются на транспортный уровень и дальше приложению уже не сильно важно, как путешествуют данные.

Наиболее популярные протоколы:
- FTP
- SMTP / POP3 / IMAP
- DNS
- HTTP

Типы архитектуры:
- Клиент-серверная. Сервер -- постоянно запущенный хост, всегда находится онлайн и обрабатывает запросы от клиентов. Имеет постоянный IP-адрес. WWW, FTP, электронная почта.
- Одноранговые (P2P) Bit-torrent, IP-телефония
- Гибридные (мессенджеры: серверы нужны для отслеживания IP-адресов пользователей, а сообщения отправляются напрямую)

## Сокеты. Адресация процессов.
Сокет -- программный интерфейс для отправки/получения сообщений (пакетов). "Дверь" между прикладным и транспортным уровнем. API между приложением и сетью. Приложение находится по прикладную сторону, и с транспортной стороны может регулировать только транспортный протокол и его базовые настройки (типа размера окна).

У хоста всегда есть свой 32-битный IP-адрес, но для адресации процессов этого недостаточно, так как процессов скорее всего много. Для идентификации процесса также необходим порт.
- порт HTTP-сервера: 80
- порт почтового сервера: 25

## Всемирная паутина и HTTP. Постоянное и непостоянное HTTP-соединение.
Терминология WWW:
- веб-страница состоит из объектов -- текст, картинки, аудио и тп
- она включает HTML-файл, который ссылается на все остальные дочерние объекты
- у каждого оюъекта -- свой URL-адрес

Протокол HTTP (HyperText Transfer Protocol)
- на прикладном уровне для веб-приложений, работает поверх TCP.
- клиент запрашивает веб-объекты, сервер их возвращает.
- stateless протокол (не сохраняет состояние): сервер не хранит информацию о последних запросах.

HTTP соединение может быть:
- Постоянное: через одно соединение можно отправить много объектов
- Непостоянное: через одно соединение можно отправить только один объект и получить ответ (результат отправки)

Round Time Trip (RTT) время, необходимое небольшому пакету на то, чтобы сгонять от клиента до сервера и обратно.

Для непостоянного соединения надо два RTT (первый -- на инициализацию TCP-соединения) + время на передачу файла.

В постоянном на каждый объект нужно по одному RTT. Ну и один инициализирующий TCP-соединение RTT, но это мелочь.

## HTTP-сообщения: запрос, ответ. Форматы HTTP-сообщений.
Кодируются в ASCII.
### Запрос
- Команда/метод: GET (запрос каких-то объектов), POST (когда ввели какие-то данные, в форме, например. Сами данные передаются в теле), HEAD (рофельный, чисто для отладки, тело сообщения пустое), ...
- URL
- строки заголовка в формате: имя поля заголовка + значение (язык, версия HTTP, используемый браузер, допускаемые кодировки, connection: keep-alive, форматы принимаемых файлов)
- тело сообщения (опционально, уже зависит от приложения)

HTTP/1.1 отличается от HTTP/1.0 добавлением новых методов (PUT,  DELETE -- аналогия с запросами в бд)

## Основные методы HTTP. Коды состояния HTTP-ответа.
### Ответ
- код состояния протокола и сообщение состояния (200 OK, 400 Bad Request, 301 Moved Permanently, 404 Not found, 505 HTTP Version Not Supported)
- строки заголовка: дата, last modified, content length, content type
- данные

## Объекты cookie («Куки»).
Механизм cookie позволяет вебсайтам отслеживать состояние пользовательского соединения. Он состоит из 4 компонентов:
1. строка заголовка в HTTP-запросе
2. строка заголовка в HTTP-ответе
3. база данных на сервере
4. cookie-файл на стороне пользователя

![screen01.png](cookie_ex.png)

С помощью куки сайты начинают предлагать "подходящую" рекламу и тп.

## Веб-кэш (прокси-сервер). Условный GET-запрос.
Кэш может устанавливаться интернет-провайдером. Также может быть в браузере. Нужен для уменьшения времени отклика и нагрузки на сервер и на сеть. *локальный прокси-сервер*.

Если у от клиента исходит GET-запрос по какой-то URL, веб сервер, если видит ответ на такой же запрос с датой data, то перенаправляет уловный GET-запрос (с полем в заголовке if-modified-since),и если сервер отвечает 304 Not Modified, то файл заново передавать смысла нет.

## FTP. Принцип работы. Команды и ответы.
FTP используется для передачи файлов на удалённый хост(сервер) и с него.
- FTP-клиент обращается к FTP-серверу по порту 21 по TCP.
На 21 порте -- управляющее соединение -- аутенфикация, запросы на скачивание/сохранения файла, ответы сервера.
- Файлы передаются по отдельному соединению по 20 порту (соединение открывается перед отправкой/получением данных, и закрывается сразу после сервером)
- Говорят, что управляюшее соединение *вне полосы*.
- Команды:
    - USER username
    - PASS password -- аутенфикация
    - LIST -- узнать список файлов в текущем каталоге
    - RETR filename -- запрос на получение файла
    - STOR -- сохранение файла
- Ответы
    - 331 Username OK, password required
    - 125 Data connection already open
    - 425 Can't open data connection
    - 452 Error writing file

## Электронная почта. SMTP.
Электронная почта состоит из трех компонент
1) Агенты пользователя -- приложения (Gmail, Outlook, ...) которые как клиенты обращаются к почтовым серверам. Каждому клиенту соответствует свой почтовый сервер
2) Почтовые сервера
3) SMTP -- протокол взаимодействия этих серверов

SMTP имеет две стороны: клиентскую (исполняется на сервере клиента) и серверную (исполняется на сервере получателя).

Происходит всё в таком порядке.
1. Алиса пишет сообщение на почту Бобу bob@gmail.com. 
2. Её агент отправляет это письмо на Алисин сервер, там оно попадает в очередь
3. Клиентская часть SMTP открывает TCP-соединение с сервером Боба.
4. Через это соединение отправляется письмо.
5. Сервер Боба кладет полученное письмо в ящик Боба.
6. Боб, когда запускает своего агента пользователя, обращается к своему почтовому серверу и тот отсылает ему письмо. 
Нюансы:
- SMTP использует порт 25 для TCP-соединения.
- если от клиента к серверу передается несколько сообщений, они идут в рамках 1 TCP-соединения.
- 7-битный ASCII-формат сообщений.
- все объекты в одном сообщении, а не как в HTTP, где у каждого объекта своё.
- такой протокол называют push-протоколом: источник сам отправляет данные приёмнику. HTTP, например -- pull-протокол -- там это происходит по запросу приемника
- метка окончания ввода сообщения: CRLF.CRLF (начала ввода -- после команды DATA)
- тоже свои запросы-команды (HELO, MAIL FR, RCPT TO, DATA, QUIT), свои коды-ответы
- формат почтового сообщения
    + заголовок (To, From, Subject), здесь To и From могут быть любой абракадаброй. Реальные отправитель и получатель идут с командами MAIL FR и RCPT TO.
    + тело сообщения

## Протоколы доступа к почте. POP3, IMAP, HTTP.
Протоколы, через которые агент пользователя может взаимодействовать со своим почтовым ящиком.

- POP (POP3) (Post Office Protocol) -- авторизация, загрузка
    - авторизация: команды клиента USER и PASS, ответы сервера OK/ERR
    - транзакция:
        - LIST -- список сообщений
        - RETR n -- загрузка сообщения по номеру
        - DELE n -- удаление (у себя локально)
        - QUIT
    - можно загрузить-и-удалить (нельзя заново прочитать сообщение с другого устройства, если удалили), можно загрузить-и-сохранить (у себя локально)
    - не сохраняет состояние сеанса
- IMAP 
    - все сообщения хранятся в 1 месте -- на сервере
    - можно хранить их в каталогах
    - сохраняет состояние сеанса
    - можно запрашивать часть сообщение (напр., заголовок)
- HTTP
    - используется начиная с Hotmail'а в 1990

## DNS: службы, структура. Серверы верхнего уровня, авторитетные и локальные сервера.
DNS -- Domain Name System: хотим соответствие между доменом и адресом. Нужна *распределенная база данных*.

DNS-протокол для решения этой проблемы: хосты спраштивают у DNS-серверов, куда идти.
- работает поверх UDP, порт 53
- функция ядра сети, реализованная на прикладном уровне
Центролизовать было бы нелогично, так как такая база данных будет удалена от многих пользователей, через нее будет идти большой трафик

Существует архитектура из 3 слоев DNS-серверов, а также независимо от неё каждым провайдером предоставляется локальный DNS-сервер.

DNS-запрос от хоста путешествует так:
1) Если интересуемая URL есть в кэше локального DNS-сервера, IP берется из него. Если нет:
2) Локальный DNS-сервер отправляет запрос в корневой DNS-сервер. Получает в качестве ответа либо IP, либо DNS-сервер верхнего уровня, куда надо пойти:
3) Локальный DNS-сервер отправляет запрос в DNS-сервер верхнего уровняы. В качестве ответа получает либо IP, либо авторитетный веб-сервер, куда надо пойти:
4) Локальный DNS-сервер отправляет запрос в авторитетный DNS-сервер. От авторитетного DNS-сервера получает либо IP, либо вердикт,  что ссылка не та.

Всего до 8 DNS-сообщений.

Корневых DNS-серверов 13 в мире. 

Сервера верхнего уровня соответствуют доменам стран .ru, .nz, .uk, ... 

Авторитетные -- сервера отдельных организаций, предоставляющие инфу о соответствии имя -> IP.

Путешествие DNS-запроса рекурсивно-итеративно. Полностью рекурсивный подход не используется на практике. Т.к. будет большая нагрузка на верзние уровни иерархии.

Запись из кэша локального DNS-сервера сбрасывается, если проходит время TTL. Обычно в нём еще есть данные о серверах верхнего уровня, поэтому к корневым молжно не обращаться.

## Формат сообщения DNS. Атаки на DNS.
Типы записей в базе данных DNS (каждая запись -- четверка [имя, значение, тип, TTL]):
- A: имя хоста, IP-адрес
- NS: имя домена, значение авторитетного DNS-сервера (чтобы перенаправлять DNS-запросы дальше по цепочке) -- например, имя мб foo.com
- CNAME: имя - всевдоним, значение -- каноническое имя (www.ibm.com – на самом деле имеет имя servereast.backup2.ibm.com)
- MX: значение -- каноническое имя почтового сервера для псевдонима в поле имя. (т.о. можно использовать одинаковые псевдонимы для почтовых и веб- серверов)

Формат сообщения (одинаковый и запроса и ответа)
- заголовок
    - идентификатор 2 байта (одинаковый у соотв. запроса и ответа)
    - флаги
        - 0 -- запрос, 1 - ответ
        - это авторитетный ответ
        - нужна ли рекурсия
        - рекурсия возможно (в ответе)
- тело
    - вопросы (поля имени и типа)
    - ответы 
    - авторитетный источник (записи ответных серверов)
    - доп. инфа

## Одноранговая раздача файлов: BitTorrent.
- Нет сервера. Узлы подключаются периодически и могут менять адреса.
- Используется в обмене файлами BitTorrent, потоковом видео, Skype.
-  $D_{P2P} \ge max(F/u_s, F/d_{min}, NF/(u_s + \sum{u_i}))$
    Тут $d_{...}$ -- скорость загрузки файла, а $u_{...}$ -- выгрузки.
Оказывается намнорго быстрее, когда одинаковый файл надо отправить от сервера в $N$ клиентов: втупую это не быстрее чем за $N F / u_s$.

Принципы:

Пусть вот они обмениваются сегментами какого-то файла.

1) Запрос сегментов: Алиса запрашивает *сначала редкие*. За счет этого редкие сегменты раздаются быстрее и количество всех сегментов уравнивается.
2) *ты-мне-я-тебе* Алиса скидывает сегменты только топ-4 пирам, которые скидывают ей. Эти топ-4 пересматриваются каждые 10 секунд
3) *оптимистическая разблокировка узла* Каждые 30 секунд рандомно выбирается новый узел и ему начинают слать сегменты. (Этот узел присоединяется к топ-4 для каждого из узлов.)

## Распределенная хеш-таблица. Циркулярная хеш-таблица. Отток пиров.
Пусть у нас снова одноранговая сеть.

Распределенная хеш-таблица (DHT, Distributed Hash-Table).
Содержит пары (ключ - файл, значение IP-адрес хоста)
Узлы добавляют такие пары в таблицу. Точнее, ключ - хеш-функция от файла, значение -- идентификационный номер хоста.

Ключи и узлы -- числа "одного диапазона". И замутим так, что каждому ключу сопоставляется узел, с ближайшим номером, который больше.

Отсортируем пиры по возрастанию, в каждом будем хранить указатель на следующий, из послежнего в первый. Тогда чтобы по ключу дойти до нужного пира, в худшем случае надо пройти их всех, а в среднем -- половину от их количества.

Можно замутить бинпоисковую идею: из каждого будет выходить по $O(logN)$ ребер, и поиск будет за $O(logN)$.

Ещё надо обработать отток пиров: из каждого по два указателя на соседа и соседа соседа вперёд и так же назад.

BitTorrent использует *Kademlia DHT* для создания распределённого трекера.





## Дополнительно
SSL - Secure Sockets Layer протокол-дополнение для TCP для обеспечения шифрования для безопасности. Работает на прикладном уровне. 